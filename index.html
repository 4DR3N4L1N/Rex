<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéì Crypto Trading Academy - Learn Crypto Risk-Free</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        * { font-family: 'Inter', sans-serif; }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .has-tooltip:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(102, 126, 234, 0.4); }
            50% { box-shadow: 0 0 40px rgba(102, 126, 234, 0.6); }
        }
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .crypto-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .tab-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .price-up { color: #10b981; }
        .price-down { color: #ef4444; }
        .slider-thumb::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
        }
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            animation: confetti-fall 3s ease-out forwards;
        }
        @keyframes confetti-fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen text-white">
    <!-- Welcome Modal -->
    <div id="welcomeModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center">
        <div class="bg-white/10 backdrop-blur-xl rounded-3xl p-8 max-w-2xl mx-4 border border-white/20 slide-in">
            <div class="text-center">
                <div class="text-6xl mb-4">üéì</div>
                <h1 class="text-4xl font-bold mb-4 gradient-text">Welcome to Crypto Trading Academy!</h1>
                <p class="text-xl text-gray-300 mb-6">Learn cryptocurrency trading risk-free with $10,000 in play money</p>
                <div class="grid md:grid-cols-3 gap-4 mb-8 text-left">
                    <div class="bg-white/5 rounded-xl p-4">
                        <div class="text-3xl mb-2">üìö</div>
                        <h3 class="font-semibold mb-1">Learn First</h3>
                        <p class="text-sm text-gray-400">Interactive lessons teach you the basics</p>
                    </div>
                    <div class="bg-white/5 rounded-xl p-4">
                        <div class="text-3xl mb-2">üí∞</div>
                        <h3 class="font-semibold mb-1">Practice Trading</h3>
                        <p class="text-sm text-gray-400">Trade with fake money, learn real skills</p>
                    </div>
                    <div class="bg-white/5 rounded-xl p-4">
                        <div class="text-3xl mb-2">üèÜ</div>
                        <h3 class="font-semibold mb-1">Earn Badges</h3>
                        <p class="text-sm text-gray-400">Complete challenges and track progress</p>
                    </div>
                </div>
                <div class="space-y-4">
                    <label class="flex items-center justify-center gap-2 text-gray-300">
                        <input type="checkbox" id="skipWelcome" class="w-5 h-5 rounded accent-purple-500">
                        <span>Don't show this again</span>
                    </label>
                    <button onclick="startApp()" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-4 px-12 rounded-full text-lg transition-all transform hover:scale-105 pulse-glow">
                        Start Learning! üöÄ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="opacity-50 pointer-events-none transition-opacity duration-500">
        <!-- Header -->
        <header class="bg-white/5 backdrop-blur-lg border-b border-white/10 sticky top-0 z-30">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <div class="flex items-center gap-3">
                        <div class="text-3xl">üéì</div>
                        <div>
                            <h1 class="text-2xl font-bold gradient-text">Crypto Academy</h1>
                            <p class="text-xs text-gray-400">Learn ‚Ä¢ Trade ‚Ä¢ Grow</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-6 bg-white/5 rounded-2xl px-6 py-3">
                        <div class="text-center">
                            <p class="text-xs text-gray-400 uppercase tracking-wider">üíµ Cash Available</p>
                            <p class="text-xl font-bold text-green-400" id="cashBalance">$10,000.00</p>
                        </div>
                        <div class="w-px h-10 bg-white/20"></div>
                        <div class="text-center">
                            <p class="text-xs text-gray-400 uppercase tracking-wider">üìà Portfolio Value</p>
                            <p class="text-xl font-bold text-blue-400" id="portfolioValue">$0.00</p>
                        </div>
                        <div class="w-px h-10 bg-white/20"></div>
                        <div class="text-center">
                            <p class="text-xs text-gray-400 uppercase tracking-wider">üí∞ Total Value</p>
                            <p class="text-xl font-bold gradient-text" id="totalValue">$10,000.00</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="text-right">
                            <p class="text-xs text-gray-400">Level <span id="userLevel">1</span></p>
                            <div class="w-32 h-2 bg-white/20 rounded-full mt-1">
                                <div id="xpBar" class="h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full transition-all" style="width: 0%"></div>
                            </div>
                        </div>
                        <button onclick="showHelp()" class="p-2 bg-white/10 rounded-lg hover:bg-white/20 transition has-tooltip">
                            <i class="fas fa-question-circle"></i>
                            <span class="tooltip absolute top-full right-0 mt-2 px-3 py-1 bg-black/80 rounded text-sm whitespace-nowrap">Get Help</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="container mx-auto px-4 py-4">
            <div class="flex gap-2 overflow-x-auto pb-2">
                <button onclick="showTab('learn')" id="tab-learn" class="tab-btn px-6 py-3 rounded-xl font-medium transition-all flex items-center gap-2 bg-white/10 hover:bg-white/20">
                    <span>üìö</span> Learn
                </button>
                <button onclick="showTab('market')" id="tab-market" class="tab-btn tab-active px-6 py-3 rounded-xl font-medium transition-all flex items-center gap-2">
                    <span>üìä</span> Market
                </button>
                <button onclick="showTab('trade')" id="tab-trade" class="tab-btn px-6 py-3 rounded-xl font-medium transition-all flex items-center gap-2 bg-white/10 hover:bg-white/20">
                    <span>üí∞</span> Trade
                </button>
                <button onclick="showTab('portfolio')" id="tab-portfolio" class="tab-btn px-6 py-3 rounded-xl font-medium transition-all flex items-center gap-2 bg-white/10 hover:bg-white/20">
                    <span>üíº</span> Portfolio
                </button>
                <button onclick="showTab('achievements')" id="tab-achievements" class="tab-btn px-6 py-3 rounded-xl font-medium transition-all flex items-center gap-2 bg-white/10 hover:bg-white/20">
                    <span>üèÜ</span> Achievements
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="container mx-auto px-4 pb-8">
            <!-- Learn Tab -->
            <div id="content-learn" class="tab-content hidden">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold mb-2">üìö Crypto Learning Center</h2>
                    <p class="text-gray-400">Master cryptocurrency trading one lesson at a time</p>
                </div>
                <div class="bg-white/5 rounded-2xl p-6 mb-8">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold">Your Learning Progress</h3>
                        <span class="text-purple-400 font-bold" id="lessonProgress">0/6 Lessons</span>
                    </div>
                    <div class="w-full h-3 bg-white/20 rounded-full">
                        <div id="lessonProgressBar" class="h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full transition-all" style="width: 0%"></div>
                    </div>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="lesson-card bg-white/5 rounded-2xl overflow-hidden border border-white/10 cursor-pointer" onclick="openLesson(1)">
                        <div class="h-32 bg-gradient-to-br from-orange-400 to-yellow-500 flex items-center justify-center">
                            <span class="text-6xl">‚Çø</span>
                        </div>
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs bg-orange-500/20 text-orange-300 px-2 py-1 rounded">Beginner</span>
                                <span class="text-xs text-gray-400">5 min</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">What is Bitcoin?</h3>
                            <p class="text-gray-400 text-sm mb-4">Learn the basics of the world's first cryptocurrency</p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-1">
                                    <i class="fas fa-star text-yellow-400"></i>
                                    <span class="text-sm">+50 XP</span>
                                </div>
                                <span class="text-purple-400 text-sm font-medium" id="lesson1-status">Start Lesson ‚Üí</span>
                            </div>
                        </div>
                    </div>
                    <div class="lesson-card bg-white/5 rounded-2xl overflow-hidden border border-white/10 cursor-pointer" onclick="openLesson(2)">
                        <div class="h-32 bg-gradient-to-br from-blue-400 to-cyan-500 flex items-center justify-center">
                            <span class="text-6xl">üìà</span>
                        </div>
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs bg-blue-500/20 text-blue-300 px-2 py-1 rounded">Beginner</span>
                                <span class="text-xs text-gray-400">8 min</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Reading Charts</h3>
                            <p class="text-gray-400 text-sm mb-4">Understanding price charts and market trends</p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-1">
                                    <i class="fas fa-star text-yellow-400"></i>
                                    <span class="text-sm">+75 XP</span>
                                </div>
                                <span class="text-purple-400 text-sm font-medium" id="lesson2-status">Locked üîí</span>
                            </div>
                        </div>
                    </div>
                    <div class="lesson-card bg-white/5 rounded-2xl overflow-hidden border border-white/10 cursor-pointer" onclick="openLesson(3)">
                        <div class="h-32 bg-gradient-to-br from-red-400 to-pink-500 flex items-center justify-center">
                            <span class="text-6xl">üõ°Ô∏è</span>
                        </div>
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs bg-red-500/20 text-red-300 px-2 py-1 rounded">Intermediate</span>
                                <span class="text-xs text-gray-400">10 min</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Risk Management</h3>
                            <p class="text-gray-400 text-sm mb-4">Protect your money: position sizing & stop losses</p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-1">
                                    <i class="fas fa-star text-yellow-400"></i>
                                    <span class="text-sm">+100 XP</span>
                                </div>
                                <span class="text-purple-400 text-sm font-medium" id="lesson3-status">Locked üîí</span>
                            </div>
                        </div>
                    </div>
                    <div class="lesson-card bg-white/5 rounded-2xl overflow-hidden border border-white/10 cursor-pointer" onclick="openLesson(4)">
                        <div class="h-32 bg-gradient-to-br from-green-400 to-emerald-500 flex items-center justify-center">
                            <span class="text-6xl">üíé</span>
                        </div>
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs bg-green-500/20 text-green-300 px-2 py-1 rounded">Intermediate</span>
                                <span class="text-xs text-gray-400">7 min</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Altcoins Explained</h3>
                            <p class="text-gray-400 text-sm mb-4">Ethereum, Solana, and other major cryptocurrencies</p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-1">
                                    <i class="fas fa-star text-yellow-400"></i>
                                    <span class="text-sm">+75 XP</span>
                                </div>
                                <span class="text-purple-400 text-sm font-medium" id="lesson4-status">Locked üîí</span>
                            </div>
                        </div>
                    </div>
                    <div class="lesson-card bg-white/5 rounded-2xl overflow-hidden border border-white/10 cursor-pointer" onclick="openLesson(5)">
                        <div class="h-32 bg-gradient-to-br from-purple-400 to-indigo-500 flex items-center justify-center">
                            <span class="text-6xl">üéØ</span>
                        </div>
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs bg-purple-500/20 text-purple-300 px-2 py-1 rounded">Advanced</span>
                                <span class="text-xs text-gray-400">12 min</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Trading Strategies</h3>
                            <p class="text-gray-400 text-sm mb-4">DCA, swing trading, and long-term holding</p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-1">
                                    <i class="fas fa-star text-yellow-400"></i>
                                    <span class="text-sm">+150 XP</span>
                                </div>
                                <span class="text-purple-400 text-sm font-medium" id="lesson5-status">Locked üîí</span>
                            </div>
                        </div>
                    </div>
                    <div class="lesson-card bg-white/5 rounded-2xl overflow-hidden border border-white/10 cursor-pointer" onclick="openLesson(6)">
                        <div class="h-32 bg-gradient-to-br from-teal-400 to-cyan-500 flex items-center justify-center">
                            <span class="text-6xl">üß†</span>
                        </div>
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs bg-teal-500/20 text-teal-300 px-2 py-1 rounded">Expert</span>
                                <span class="text-xs text-gray-400">15 min</span>
                            </div>
                            <h3 class="text-xl font-bold mb-2">Market Psychology</h3>
                            <p class="text-gray-400 text-sm mb-4">FOMO, FUD, and emotional trading control</p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-1">
                                    <i class="fas fa-star text-yellow-400"></i>
                                    <span class="text-sm">+200 XP</span>
                                </div>
                                <span class="text-purple-400 text-sm font-medium" id="lesson6-status">Locked üîí</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Market Tab -->
            <div id="content-market" class="tab-content">
                <div class="bg-white/5 rounded-2xl p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold flex items-center gap-2">
                            üò®ü§ë Crypto Fear & Greed Index
                            <span class="has-tooltip">
                                <i class="fas fa-info-circle text-gray-400 cursor-help"></i>
                                <span class="tooltip max-w-xs bg-black/90 p-3 rounded-lg text-sm">
                                    Measures market sentiment. Extreme fear = possible buying opportunity. Extreme greed = possible correction coming.
                                </span>
                            </span>
                        </h3>
                        <span class="text-sm text-gray-400">Updated hourly</span>
                    </div>
                    <div class="relative h-8 bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 rounded-full overflow-hidden">
                        <div id="fearGreedMarker" class="absolute top-0 w-1 h-full bg-white shadow-lg transition-all" style="left: 50%"></div>
                        <div class="flex justify-between px-4 py-1 text-xs font-bold">
                            <span>Extreme Fear</span>
                            <span>Fear</span>
                            <span>Neutral</span>
                            <span>Greed</span>
                            <span>Extreme Greed</span>
                        </div>
                    </div>
                    <p class="text-center mt-2 text-lg font-semibold" id="fearGreedText">Neutral (50)</p>
                </div>

                <div class="grid lg:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white/5 rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">üöÄ Top Gainers (24h)</h3>
                        <div id="topGainers" class="space-y-3">
                            <div class="animate-pulse space-y-3">
                                <div class="h-12 bg-white/10 rounded"></div>
                                <div class="h-12 bg-white/10 rounded"></div>
                                <div class="h-12 bg-white/10 rounded"></div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white/5 rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">üìâ Top Losers (24h)</h3>
                        <div id="topLosers" class="space-y-3">
                            <div class="animate-pulse space-y-3">
                                <div class="h-12 bg-white/10 rounded"></div>
                                <div class="h-12 bg-white/10 rounded"></div>
                                <div class="h-12 bg-white/10 rounded"></div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white/5 rounded-2xl p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">üî• Trending Now</h3>
                        <div id="trendingCoins" class="space-y-3">
                            <div class="animate-pulse space-y-3">
                                <div class="h-12 bg-white/10 rounded"></div>
                                <div class="h-12 bg-white/10 rounded"></div>
                                <div class="h-12 bg-white/10 rounded"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white/5 rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-6 flex-wrap gap-4">
                        <h3 class="text-xl font-semibold">üìä All Cryptocurrencies</h3>
                        <div class="relative">
                            <input type="text" id="cryptoSearch" placeholder="Search coins..." 
                                class="bg-white/10 border border-white/20 rounded-xl px-4 py-2 pl-10 w-64 focus:outline-none focus:border-purple-500 transition">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="text-left text-gray-400 border-b border-white/10">
                                    <th class="pb-4 pl-4">#</th>
                                    <th class="pb-4">Coin</th>
                                    <th class="pb-4">Price</th>
                                    <th class="pb-4">24h Change</th>
                                    <th class="pb-4">Market Cap</th>
                                    <th class="pb-4">Action</th>
                                </tr>
                            </thead>
                            <tbody id="cryptoTable">
                                <tr>
                                    <td colspan="6" class="py-8 text-center text-gray-400">
                                        <div class="animate-spin inline-block w-8 h-8 border-2 border-purple-500 border-t-transparent rounded-full"></div>
                                        <p class="mt-2">Loading cryptocurrencies...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Trade Tab -->
            <div id="content-trade" class="tab-content hidden">
                <div class="grid lg:grid-cols-2 gap-6">
                    <div class="bg-white/5 rounded-2xl p-6 border border-green-500/30">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-12 h-12 bg-green-500/20 rounded-full flex items-center justify-center">
                                <i class="fas fa-arrow-down text-green-400 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold text-green-400">Buy Crypto</h3>
                                <p class="text-gray-400 text-sm">Purchase cryptocurrency with your cash</p>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Select Cryptocurrency</label>
                                <select id="buyCryptoSelect" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 focus:outline-none focus:border-green-500 transition">
                                    <option value="">Choose a coin...</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Amount to Spend (USD)</label>
                                <input type="range" id="buyAmountSlider" min="0" max="10000" value="0" step="10" class="w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer slider-thumb mb-2">
                                <div class="flex items-center gap-2">
                                    <span class="text-2xl font-bold text-green-400">$</span>
                                    <input type="number" id="buyAmount" value="0" min="0" step="0.01" class="bg-white/10 border border-white/20 rounded-xl px-4 py-2 text-2xl font-bold w-full focus:outline-none focus:border-green-500 transition">
                                </div>
                                <div class="flex gap-2 mt-2">
                                    <button onclick="setBuyAmount(100)" class="flex-1 py-1 px-2 bg-white/10 rounded-lg text-xs hover:bg-white/20 transition">$100</button>
                                    <button onclick="setBuyAmount(500)" class="flex-1 py-1 px-2 bg-white/10 rounded-lg text-xs hover:bg-white/20 transition">$500</button>
                                    <button onclick="setBuyAmount(1000)" class="flex-1 py-1 px-2 bg-white/10 rounded-lg text-xs hover:bg-white/20 transition">$1000</button>
                                    <button onclick="setBuyAmount('max')" class="flex-1 py-1 px-2 bg-green-500/20 text-green-400 rounded-lg text-xs hover:bg-green-500/30 transition">MAX</button>
                                </div>
                            </div>
                            <div class="bg-white/5 rounded-xl p-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span class="text-gray-400">You'll receive:</span>
                                    <span class="font-bold" id="buyReceiveAmount">0 BTC</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">Current price:</span>
                                    <span class="font-bold" id="buyCurrentPrice">--</span>
                                </div>
                            </div>
                            <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4 flex items-start gap-3">
                                <i class="fas fa-lightbulb text-yellow-400 mt-1"></i>
                                <p class="text-sm text-yellow-200"><strong>Tip:</strong> Never invest more than you can afford to lose. Consider starting with a small amount while learning!</p>
                            </div>
                            <button onclick="executeBuy()" id="buyButton" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-4 rounded-xl transition-all transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed">üí∞ Buy Now</button>
                        </div>
                    </div>
                    <div class="bg-white/5 rounded-2xl p-6 border border-red-500/30">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-12 h-12 bg-red-500/20 rounded-full flex items-center justify-center">
                                <i class="fas fa-arrow-up text-red-400 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold text-red-400">Sell Crypto</h3>
                                <p class="text-gray-400 text-sm">Sell your holdings for cash</p>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Select Holding</label>
                                <select id="sellCryptoSelect" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 focus:outline-none focus:border-red-500 transition">
                                    <option value="">Choose a holding...</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Amount to Sell (%)</label>
                                <input type="range" id="sellAmountSlider" min="0" max="100" value="0" step="1" class="w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer slider-thumb mb-2">
                                <div class="flex items-center gap-2">
                                    <input type="number" id="sellPercent" value="0" min="0" max="100" class="bg-white/10 border border-white/20 rounded-xl px-4 py-2 text-2xl font-bold w-24 text-center focus:outline-none focus:border-red-500 transition">
                                    <span class="text-2xl font-bold">%</span>
                                </div>
                                <div class="flex gap-2 mt-2">
                                    <button onclick="setSellPercent(25)" class="flex-1 py-1 px-2 bg-white/10 rounded-lg text-xs hover:bg-white/20 transition">25%</button>
                                    <button onclick="setSellPercent(50)" class="flex-1 py-1 px-2 bg-white/10 rounded-lg text-xs hover:bg-white/20 transition">50%</button>
                                    <button onclick="setSellPercent(75)" class="flex-1 py-1 px-2 bg-white/10 rounded-lg text-xs hover:bg-white/20 transition">75%</button>
                                    <button onclick="setSellPercent(100)" class="flex-1 py-1 px-2 bg-red-500/20 text-red-400 rounded-lg text-xs hover:bg-red-500/30 transition">ALL</button>
                                </div>
                            </div>
                            <div class="bg-white/5 rounded-xl p-4">
                                <div class="flex justify-between text-sm mb-2">
                                    <span class="text-gray-400">You'll receive:</span>
                                    <span class="font-bold text-green-400" id="sellReceiveAmount">$0.00</span>
                                </div>
                                <div class="flex justify-between text-sm mb-2">
                                    <span class="text-gray-400">Your cost basis:</span>
                                    <span class="font-bold" id="sellCostBasis">--</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-400">Profit/Loss:</span>
                                    <span class="font-bold" id="sellProfitLoss">--</span>
                                </div>
                            </div>
                            <button onclick="executeSell()" id="sellButton" class="w-full bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white font-bold py-4 rounded-xl transition-all transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed">üí∏ Sell Now</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Portfolio Tab -->
            <div id="content-portfolio" class="tab-content hidden">
                <div class="grid lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 space-y-6">
                        <div class="grid md:grid-cols-4 gap-4">
                            <div class="bg-white/5 rounded-2xl p-4 text-center">
                                <p class="text-gray-400 text-sm mb-1">Total Value</p>
                                <p class="text-2xl font-bold gradient-text" id="portTotalValue">$10,000</p>
                            </div>
                            <div class="bg-white/5 rounded-2xl p-4 text-center">
                                <p class="text-gray-400 text-sm mb-1">Cash</p>
                                <p class="text-2xl font-bold text-green-400" id="portCash">$10,000</p>
                            </div>
                            <div class="bg-white/5 rounded-2xl p-4 text-center">
                                <p class="text-gray-400 text-sm mb-1">Invested</p>
                                <p class="text-2xl font-bold text-blue-400" id="portInvested">$0</p>
                            </div>
                            <div class="bg-white/5 rounded-2xl p-4 text-center">
                                <p class="text-gray-400 text-sm mb-1">Total Return</p>
                                <p class="text-2xl font-bold" id="portReturn">0%</p>
                            </div>
                        </div>
                        <div class="bg-white/5 rounded-2xl p-6">
                            <h3 class="text-xl font-semibold mb-4">üìä Portfolio Allocation</h3>
                            <div class="h-64">
                                <canvas id="portfolioChart"></canvas>
                            </div>
                            <p class="text-center text-gray-400 mt-4 text-sm" id="emptyPortfolioMsg">Start trading to see your portfolio allocation!</p>
                        </div>
                        <div class="bg-white/5 rounded-2xl p-6">
                            <h3 class="text-xl font-semibold mb-4">üíº Your Holdings</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="text-left text-gray-400 border-b border-white/10">
                                            <th class="pb-4">Coin</th>
                                            <th class="pb-4">Amount</th>
                                            <th class="pb-4">Avg. Buy Price</th>
                                            <th class="pb-4">Current Price</th>
                                            <th class="pb-4">Current Value</th>
                                            <th class="pb-4">Profit/Loss</th>
                                        </tr>
                                    </thead>
                                    <tbody id="holdingsTable">
                                        <tr>
                                            <td colspan="6" class="py-8 text-center text-gray-400">
                                                <div class="text-4xl mb-2">üì≠</div>
                                                <p>No holdings yet. Start trading!</p>
                                                <button onclick="showTab('trade')" class="mt-4 px-4 py-2 bg-purple-500 rounded-lg hover:bg-purple-600 transition">Go to Trade ‚Üí</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-6">
                        <div class="bg-white/5 rounded-2xl p-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">‚ù§Ô∏è Portfolio Health</h3>
                            <div class="relative w-32 h-32 mx-auto mb-4">
                                <svg class="progress-ring w-32 h-32" viewBox="0 0 128 128">
                                    <circle cx="64" cy="64" r="56" stroke="rgba(255,255,255,0.1)" stroke-width="12" fill="none"/>
                                    <circle id="healthRing" cx="64" cy="64" r="56" stroke="#10b981" stroke-width="12" fill="none" stroke-dasharray="351.86" stroke-dashoffset="351.86" stroke-linecap="round" class="transition-all duration-1000"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-3xl font-bold" id="healthScore">--</span>
                                </div>
                            </div>
                            <p class="text-center text-sm text-gray-400" id="healthText">Start trading to see your score</p>
                        </div>
                        <div class="bg-white/5 rounded-2xl p-6">
                            <h3 class="text-lg font-semibold mb-4">üìù Recent Trades</h3>
                            <div id="transactionHistory" class="space-y-3 max-h-80 overflow-y-auto">
                                <p class="text-gray-400 text-center py-4">No trades yet!</p>
                            </div>
                        </div>
                        <button onclick="resetPortfolio()" class="w-full py-3 border border-red-500/50 text-red-400 rounded-xl hover:bg-red-500/10 transition">üîÑ Reset Portfolio (Start Over)</button>
                    </div>
                </div>
            </div>

            <!-- Achievements Tab -->
            <div id="content-achievements" class="tab-content hidden">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold mb-2">üèÜ Your Achievements</h2>
                    <p class="text-gray-400">Collect badges by completing tasks and reaching milestones!</p>
                </div>
                <div class="grid md:grid-cols-4 lg:grid-cols-6 gap-4" id="achievementsGrid"></div>
            </div>
        </main>
    </div>

    <!-- Lesson Modal -->
    <div id="lessonModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white/10 backdrop-blur-xl rounded-3xl max-w-3xl w-full max-h-[90vh] overflow-y-auto border border-white/20">
            <div class="p-8">
                <div class="flex items-center justify-between mb-6">
                    <span class="text-sm text-gray-400" id="lessonModalCategory">Category</span>
                    <button onclick="closeLesson()" class="text-gray-400 hover:text-white transition"><i class="fas fa-times text-2xl"></i></button>
                </div>
                <h2 class="text-3xl font-bold mb-4 gradient-text" id="lessonModalTitle">Lesson Title</h2>
                <div class="prose prose-invert max-w-none" id="lessonModalContent"></div>
                <div class="mt-8 pt-6 border-t border-white/10 flex justify-between">
                    <button onclick="closeLesson()" class="px-6 py-3 text-gray-400 hover:text-white transition">Close</button>
                    <button onclick="completeLesson()" id="completeLessonBtn" class="px-8 py-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-semibold hover:from-purple-600 hover:to-pink-600 transition">‚úì Mark as Complete (+XP)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <script>
        // Application State
        const state = {
            cash: 10000,
            holdings: {},
            transactions: [],
            cryptoData: [],
            user: {
                level: 1,
                xp: 0,
                completedLessons: [],
                achievements: [],
                skipWelcome: false
            },
            currentLesson: null,
            portfolioChart: null
        };
        let cryptoCache = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            initializeAchievements();
            updateUI();
            fetchCryptoData();
            setInterval(fetchCryptoData, 60000);
            setupEventListeners();
        });

        function loadState() {
            const saved = localStorage.getItem('cryptoAcademyState');
            if (saved) {
                const parsed = JSON.parse(saved);
                state.cash = parsed.cash || 10000;
                state.holdings = parsed.holdings || {};
                state.transactions = parsed.transactions || [];
                state.user = { ...state.user, ...parsed.user };
                if (state.user.skipWelcome) {
                    document.getElementById('welcomeModal').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('opacity-50', 'pointer-events-none');
                }
            }
        }

        function saveState() {
            localStorage.setItem('cryptoAcademyState', JSON.stringify({
                cash: state.cash,
                holdings: state.holdings,
                transactions: state.transactions,
                user: state.user
            }));
        }

        function updateUI() {
            updateBalance();
            updatePortfolioValue();
            updateHoldingsTable();
            updateTransactionHistory();
            updateTradeOptions();
            updatePortfolioChart();
            updateHealthScore();
            updateLevel();
            updateLessonProgress();
            updateAchievements();
        }

        function updateBalance() {
            document.getElementById('cashBalance').textContent = formatMoney(state.cash);
        }

        function updatePortfolioValue() {
            let value = state.cash;
            for (const [id, holding] of Object.entries(state.holdings)) {
                const crypto = cryptoCache.find(c => c.id === id);
                if (crypto) {
                    value += holding.amount * crypto.current_price;
                }
            }
            document.getElementById('portfolioValue').textContent = formatMoney(value - state.cash);
            document.getElementById('totalValue').textContent = formatMoney(value);
            document.getElementById('portTotalValue').textContent = formatMoney(value);
            document.getElementById('portCash').textContent = formatMoney(state.cash);
        }

        function updatePortfolioChart() {
            const ctx = document.getElementById('portfolioChart');
            if (!ctx) return;
            const labels = ['Cash'];
            const data = [state.cash];
            const colors = ['#10b981'];
            for (const [id, holding] of Object.entries(state.holdings)) {
                const crypto = cryptoCache.find(c => c.id === id);
                if (crypto && holding.amount > 0) {
                    labels.push(crypto.symbol.toUpperCase());
                    data.push(holding.amount * crypto.current_price);
                    colors.push(stringToColor(id));
                }
            }
            if (state.portfolioChart) {
                state.portfolioChart.destroy();
            }
            if (labels.length === 1) {
                document.getElementById('emptyPortfolioMsg').classList.remove('hidden');
                return;
            }
            document.getElementById('emptyPortfolioMsg').classList.add('hidden');
            state.portfolioChart = new Chart(ctx, {
                type: 'doughnut',
                data: { labels: labels, datasets: [{ data: data, backgroundColor: colors, borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: '#fff' } } } }
            });
        }

        function updateHealthScore() {
            const holdingCount = Object.keys(state.holdings).length;
            const totalInvested = Object.values(state.holdings).reduce((sum, h) => sum + h.totalCost, 0);
            let score = holdingCount === 0 ? 0 : holdingCount === 1 ? 40 : holdingCount === 2 ? 60 : holdingCount >= 3 && holdingCount <= 6 ? 100 : 80;
            for (const [id, holding] of Object.entries(state.holdings)) {
                const crypto = cryptoCache.find(c => c.id === id);
                if (crypto) {
                    const value = holding.amount * crypto.current_price;
                    if (value > totalInvested * 0.7) score -= 20;
                }
            }
            score = Math.max(0, Math.min(100, score));
            const ring = document.getElementById('healthRing');
            const circumference = 351.86;
            const offset = circumference - (score / 100) * circumference;
            ring.style.strokeDashoffset = offset;
            let color = score >= 80 ? '#10b981' : score >= 60 ? '#f59e0b' : score >= 40 ? '#f97316' : '#ef4444';
            ring.style.stroke = color;
            document.getElementById('healthScore').textContent = score;
            document.getElementById('healthScore').style.color = color;
            document.getElementById('healthText').textContent = score >= 80 ? 'Excellent diversification! üåü' : score >= 60 ? 'Good balance üëç' : score >= 40 ? 'Consider diversifying more' : 'Needs improvement';
        }

        function updateHoldingsTable() {
            const tbody = document.getElementById('holdingsTable');
            const holdingIds = Object.keys(state.holdings);
            if (holdingIds.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="py-8 text-center text-gray-400"><div class="text-4xl mb-2">üì≠</div><p>No holdings yet. Start trading!</p><button onclick="showTab('trade')" class="mt-4 px-4 py-2 bg-purple-500 rounded-lg hover:bg-purple-600 transition">Go to Trade ‚Üí</button></td></tr>`;
                return;
            }
            let totalInvested = 0;
            tbody.innerHTML = holdingIds.map(id => {
                const holding = state.holdings[id];
                const crypto = cryptoCache.find(c => c.id === id);
                if (!crypto || holding.amount <= 0) return '';
                const currentValue = holding.amount * crypto.current_price;
                const profit = currentValue - holding.totalCost;
                const profitPercent = (profit / holding.totalCost) * 100;
                totalInvested += holding.totalCost;
                return `<tr class="border-b border-white/5 hover:bg-white/5 transition">
                    <td class="py-4"><div class="flex items-center gap-3"><img src="${crypto.image}" class="w-8 h-8 rounded-full"><div><p class="font-semibold">${crypto.name}</p><p class="text-sm text-gray-400">${crypto.symbol.toUpperCase()}</p></div></div></td>
                    <td class="py-4">${holding.amount.toFixed(6)} ${crypto.symbol.toUpperCase()}</td>
                    <td class="py-4">$${holding.avgPrice.toFixed(2)}</td>
                    <td class="py-4">$${crypto.current_price.toFixed(2)}</td>
                    <td class="py-4 font-semibold">${formatMoney(currentValue)}</td>
                    <td class="py-4"><span class="${profit >= 0 ? 'text-green-400' : 'text-red-400'} font-semibold">${profit >= 0 ? '+' : ''}${formatMoney(profit)} (${profitPercent.toFixed(2)}%)</span></td>
                </tr>`;
            }).join('');
            document.getElementById('portInvested').textContent = formatMoney(totalInvested);
            const totalValue = parseFloat(document.getElementById('totalValue').textContent.replace(/[$,]/g, ''));
            const totalReturn = totalInvested > 0 ? ((totalValue - 10000) / 10000) * 100 : 0;
            const returnEl = document.getElementById('portReturn');
            returnEl.textContent = (totalReturn >= 0 ? '+' : '') + totalReturn.toFixed(2) + '%';
            returnEl.className = 'text-2xl font-bold ' + (totalReturn >= 0 ? 'text-green-400' : 'text-red-400');
        }

        function updateTransactionHistory() {
            const container = document.getElementById('transactionHistory');
            if (state.transactions.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-center py-4">No trades yet!</p>';
                return;
            }
            container.innerHTML = state.transactions.slice().reverse().slice(0, 20).map(t => {
                const isBuy = t.type === 'buy';
                return `<div class="flex items-center justify-between p-3 bg-white/5 rounded-lg ${isBuy ? 'border-l-4 border-green-500' : 'border-l-4 border-red-500'}">
                    <div><p class="font-semibold ${isBuy ? 'text-green-400' : 'text-red-400'}">${isBuy ? 'Bought' : 'Sold'} ${t.amount.toFixed(4)} ${t.symbol.toUpperCase()}</p><p class="text-xs text-gray-400">${new Date(t.date).toLocaleString()}</p></div>
                    <div class="text-right"><p class="font-semibold">${formatMoney(t.total)}</p><p class="text-xs text-gray-400">@ $${t.price.toFixed(2)}</p></div>
                </div>`;
            }).join('');
        }

        function updateTradeOptions() {
            const buySelect = document.getElementById('buyCryptoSelect');
            buySelect.innerHTML = '<option value="">Choose a coin...</option>' + cryptoCache.map(c => `<option value="${c.id}">${c.name} (${c.symbol.toUpperCase()}) - $${c.current_price.toFixed(2)}</option>`).join('');
            const sellSelect = document.getElementById('sellCryptoSelect');
            const holdingIds = Object.keys(state.holdings).filter(id => state.holdings[id].amount > 0);
            if (holdingIds.length === 0) {
                sellSelect.innerHTML = '<option value="">No holdings yet</option>';
            } else {
                sellSelect.innerHTML = '<option value="">Choose a holding...</option>' + holdingIds.map(id => {
                    const holding = state.holdings[id];
                    const crypto = cryptoCache.find(c => c.id === id);
                    if (!crypto) return '';
                    return `<option value="${id}">${crypto.name} (${holding.amount.toFixed(4)} ${crypto.symbol.toUpperCase()})</option>`;
                }).join('');
            }
        }

        function updateLevel() {
            document.getElementById('userLevel').textContent = state.user.level;
            const progress = state.user.xp % 100;
            document.getElementById('xpBar').style.width = progress + '%';
        }

        function updateLessonProgress() {
            const completed = state.user.completedLessons.length;
            document.getElementById('lessonProgress').textContent = `${completed}/6 Lessons`;
            document.getElementById('lessonProgressBar').style.width = (completed / 6 * 100) + '%';
            for (let i = 1; i <= 6; i++) {
                const statusEl = document.getElementById(`lesson${i}-status`);
                if (state.user.completedLessons.includes(i)) {
                    statusEl.textContent = 'Completed ‚úì';
                    statusEl.className = 'text-green-400 text-sm font-medium';
                } else if (i === 1 || state.user.completedLessons.includes(i - 1)) {
                    statusEl.textContent = 'Start Lesson ‚Üí';
                    statusEl.className = 'text-purple-400 text-sm font-medium';
                }
            }
        }

        function setBuyAmount(amount) {
            if (amount === 'max') amount = state.cash;
            document.getElementById('buyAmount').value = amount;
            document.getElementById('buyAmountSlider').value = amount;
            updateBuyPreview();
        }

        function setSellPercent(percent) {
            document.getElementById('sellPercent').value = percent;
            document.getElementById('sellAmountSlider').value = percent;
            updateSellPreview();
        }

        function updateBuyPreview() {
            const cryptoId = document.getElementById('buyCryptoSelect').value;
            const amount = parseFloat(document.getElementById('buyAmount').value) || 0;
            if (!cryptoId) {
                document.getElementById('buyReceiveAmount').textContent = '0 BTC';
                document.getElementById('buyCurrentPrice').textContent = '--';
                return;
            }
            const crypto = cryptoCache.find(c => c.id === cryptoId);
            if (crypto) {
                const receiveAmount = amount / crypto.current_price;
                document.getElementById('buyReceiveAmount').textContent = `${receiveAmount.toFixed(6)} ${crypto.symbol.toUpperCase()}`;
                document.getElementById('buyCurrentPrice').textContent = `$${crypto.current_price.toFixed(2)}`;
            }
        }

        function updateSellPreview() {
            const cryptoId = document.getElementById('sellCryptoSelect').value;
            const percent = parseFloat(document.getElementById('sellPercent').value) || 0;
            if (!cryptoId || !state.holdings[cryptoId]) {
                document.getElementById('sellReceiveAmount').textContent = '$0.00';
                document.getElementById('sellCostBasis').textContent = '--';
                document.getElementById('sellProfitLoss').textContent = '--';
                return;
            }
            const holding = state.holdings[cryptoId];
            const crypto = cryptoCache.find(c => c.id === cryptoId);
            if (crypto) {
                const sellAmount = holding.amount * (percent / 100);
                const receiveAmount = sellAmount * crypto.current_price;
                const costBasis = sellAmount * holding.avgPrice;
                const profit = receiveAmount - costBasis;
                document.getElementById('sellReceiveAmount').textContent = formatMoney(receiveAmount);
                document.getElementById('sellCostBasis').textContent = formatMoney(costBasis);
                const plEl = document.getElementById('sellProfitLoss');
                plEl.textContent = (profit >= 0 ? '+' : '') + formatMoney(profit);
                plEl.className = 'font-bold ' + (profit >= 0 ? 'text-green-400' : 'text-red-400');
            }
        }

        function executeBuy() {
            const cryptoId = document.getElementById('buyCryptoSelect').value;
            const amount = parseFloat(document.getElementById('buyAmount').value) || 0;
            if (!cryptoId) { showToast('Please select a cryptocurrency', 'error'); return; }
            if (amount <= 0 || amount > state.cash) { showToast('Invalid amount or insufficient funds', 'error'); return; }
            const crypto = cryptoCache.find(c => c.id === cryptoId);
            if (!crypto) return;
            const coinAmount = amount / crypto.current_price;
            if (!state.holdings[cryptoId]) {
                state.holdings[cryptoId] = { amount: 0, totalCost: 0, avgPrice: 0 };
            }
            const holding = state.holdings[cryptoId];
            holding.totalCost += amount;
            holding.amount += coinAmount;
            holding.avgPrice = holding.totalCost / holding.amount;
            state.cash -= amount;
            state.transactions.push({ type: 'buy', id: cryptoId, symbol: crypto.symbol, amount: coinAmount, price: crypto.current_price, total: amount, date: new Date().toISOString() });
            addXP(10);
            unlockAchievement('first_buy');
            saveState();
            updateUI();
            showToast(`Successfully bought ${coinAmount.toFixed(6)} ${crypto.symbol.toUpperCase()}!`, 'success');
            document.getElementById('buyAmount').value = 0;
            document.getElementById('buyAmountSlider').value = 0;
            updateBuyPreview();
        }

        function executeSell() {
            const cryptoId = document.getElementById('sellCryptoSelect').value;
            const percent = parseFloat(document.getElementById('sellPercent').value) || 0;
            if (!cryptoId || !state.holdings[cryptoId]) { showToast('Please select a holding', 'error'); return; }
            const holding = state.holdings[cryptoId];
            const crypto = cryptoCache.find(c => c.id === cryptoId);
            if (!crypto || holding.amount <= 0) return;
            const sellAmount = holding.amount * (percent / 100);
            const receiveAmount = sellAmount * crypto.current_price;
            if (sellAmount <= 0) { showToast('Invalid amount', 'error'); return; }
            const costBasis = sellAmount * holding.avgPrice;
            holding.amount -= sellAmount;
            holding.totalCost -= costBasis;
            if (holding.amount <= 0.000001) delete state.holdings[cryptoId];
            state.cash += receiveAmount;
            state.transactions.push({ type: 'sell', id: cryptoId, symbol: crypto.symbol, amount: sellAmount, price: crypto.current_price, total: receiveAmount, date: new Date().toISOString() });
            addXP(10);
            unlockAchievement('first_sell');
            const profit = receiveAmount - costBasis;
            if (profit > 0) unlockAchievement('first_profit');
            saveState();
            updateUI();
            showToast(`Sold! ${profit >= 0 ? 'Profit' : 'Loss'}: ${formatMoney(Math.abs(profit))}`, profit >= 0 ? 'success' : 'info');
            document.getElementById('sellPercent').value = 0;
            document.getElementById('sellAmountSlider').value = 0;
            updateSellPreview();
        }

        function resetPortfolio() {
            if (!confirm('Are you sure? This will reset all your progress and return you to $10,000.')) return;
            state.cash = 10000;
            state.holdings = {};
            state.transactions = [];
            state.user.xp = 0;
            state.user.level = 1;
            state.user.completedLessons = [];
            state.user.achievements = [];
            initializeAchievements();
            saveState();
            updateUI();
            showToast('Portfolio reset! Starting fresh.', 'info');
        }

        async function fetchCryptoData() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=50&page=1&sparkline=false&price_change_percentage=24h');
                const data = await response.json();
                cryptoCache = data;
                updateCryptoTable();
                updateTopMovers();
                updateTradeOptions();
                updateHoldingsTable();
                updatePortfolioValue();
                updateFearGreedIndex();
            } catch (error) {
                console.error('Failed to fetch crypto data:', error);
            }
        }

        function updateCryptoTable() {
            const tbody = document.getElementById('cryptoTable');
            const search = document.getElementById('cryptoSearch')?.value.toLowerCase() || '';
            let filtered = search ? cryptoCache.filter(c => c.name.toLowerCase().includes(search) || c.symbol.toLowerCase().includes(search)) : cryptoCache;
            tbody.innerHTML = filtered.slice(0, 20).map((c, i) => {
                const change = c.price_change_percentage_24h || 0;
                return `<tr class="border-b border-white/5 hover:bg-white/5 transition crypto-card cursor-pointer" onclick="selectCrypto('${c.id}')">
                    <td class="py-4 pl-4 text-gray-400">${c.market_cap_rank || i + 1}</td>
                    <td class="py-4"><div class="flex items-center gap-3"><img src="${c.image}" class="w-8 h-8 rounded-full"><div><p class="font-semibold">${c.name}</p><p class="text-sm text-gray-400">${c.symbol.toUpperCase()}</p></div></div></td>
                    <td class="py-4 font-semibold">$${c.current_price.toLocaleString()}</td>
                    <td class="py-4"><span class="${change >= 0 ? 'price-up' : 'price-down'} font-semibold">${change >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(change).toFixed(2)}%</span></td>
                    <td class="py-4 text-gray-400">$${(c.market_cap / 1e9).toFixed(1)}B</td>
                    <td class="py-4 pr-4"><button onclick="event.stopPropagation(); quickBuy('${c.id}')" class="px-3 py-1 bg-green-500/20 text-green-400 rounded-lg text-sm hover:bg-green-500/30 transition">Buy</button></td>
                </tr>`;
            }).join('');
        }

        function updateTopMovers() {
            const sorted = [...cryptoCache].sort((a, b) => (b.price_change_percentage_24h || 0) - (a.price_change_percentage_24h || 0));
            const gainers = sorted.slice(0, 5);
            const losers = sorted.slice(-5).reverse();
            document.getElementById('topGainers').innerHTML = gainers.map(c => `<div class="flex items-center justify-between p-3 bg-white/5 rounded-lg"><div class="flex items-center gap-3"><img src="${c.image}" class="w-8 h-8 rounded-full"><div><p class="font-semibold text-sm">${c.symbol.toUpperCase()}</p><p class="text-xs text-gray-400">$${c.current_price.toFixed(2)}</p></div></div><span class="text-green-400 font-semibold">+${(c.price_change_percentage_24h || 0).toFixed(2)}%</span></div>`).join('');
            document.getElementById('topLosers').innerHTML = losers.map(c => `<div class="flex items-center justify-between p-3 bg-white/5 rounded-lg"><div class="flex items-center gap-3"><img src="${c.image}" class="w-8 h-8 rounded-full"><div><p class="font-semibold text-sm">${c.symbol.toUpperCase()}</p><p class="text-xs text-gray-400">$${c.current_price.toFixed(2)}</p></div></div><span class="text-red-400 font-semibold">${(c.price_change_percentage_24h || 0).toFixed(2)}%</span></div>`).join('');
            const trending = [...cryptoCache].sort((a, b) => b.total_volume - a.total_volume).slice(0, 5);
            document.getElementById('trendingCoins').innerHTML = trending.map(c => `<div class="flex items-center justify-between p-3 bg-white/5 rounded-lg"><div class="flex items-center gap-3"><img src="${c.image}" class="w-8 h-8 rounded-full"><div><p class="font-semibold text-sm">${c.name}</p><p class="text-xs text-gray-400">Vol: $${(c.total_volume / 1e9).toFixed(1)}B</p></div></div><span class="text-orange-400 text-sm">üî• Trending</span></div>`).join('');
        }

        function updateFearGreedIndex() {
            const avgChange = cryptoCache.slice(0, 10).reduce((sum, c) => sum + (c.price_change_percentage_24h || 0), 0) / 10;
            let value = Math.max(0, Math.min(100, 50 + (avgChange * 2)));
            document.getElementById('fearGreedMarker').style.left = value + '%';
            let text = value < 25 ? 'Extreme Fear' : value < 45 ? 'Fear' : value > 75 ? 'Extreme Greed' : value > 55 ? 'Greed' : 'Neutral';
            let color = value < 25 ? 'text-red-400' : value < 45 ? 'text-orange-400' : value > 75 ? 'text-green-400' : value > 55 ? 'text-green-300' : 'text-yellow-400';
            const textEl = document.getElementById('fearGreedText');
            textEl.textContent = `${text} (${Math.round(value)})`;
            textEl.className = 'text-center mt-2 text-lg font-semibold ' + color;
        }

        const lessons = {
            1: {
                title: 'What is Bitcoin?',
                category: 'Beginner',
                content: `<div class="space-y-6"><div class="bg-orange-500/10 border border-orange-500/30 rounded-xl p-6"><h3 class="text-xl font-semibold mb-4 text-orange-400">‚Çø The Digital Gold</h3><p class="mb-4">Bitcoin (BTC) is the world's first cryptocurrency, created in 2009 by an anonymous person (or group) named Satoshi Nakamoto. It's often called "digital gold" because, like gold, there's a limited supply ‚Äî only 21 million Bitcoin will ever exist!</p></div><h4 class="text-lg font-semibold">ü§î Why Was Bitcoin Created?</h4><p>After the 2008 financial crisis, people lost trust in banks. Bitcoin was designed to be:</p><ul class="list-disc list-inside space-y-2 ml-4"><li><strong>Decentralized</strong> ‚Äî No single company or government controls it</li><li><strong>Transparent</strong> ‚Äî All transactions are visible on the blockchain</li><li><strong>Limited supply</strong> ‚Äî Unlike dollars, Bitcoin can't be printed infinitely</li><li><strong>Borderless</strong> ‚Äî Send money anywhere in the world instantly</li></ul><div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-6"><h4 class="text-lg font-semibold mb-2 text-blue-400">üí° Did You Know?</h4><p>The first Bitcoin transaction was for two pizzas! On May 22, 2010, someone paid 10,000 BTC for two pizzas. Today, that would be worth hundreds of millions of dollars! üçï</p></div></div>`
            },
            2: {
                title: 'Reading Charts',
                category: 'Beginner',
                content: `<div class="space-y-6"><div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-6"><h3 class="text-xl font-semibold mb-4 text-blue-400">üìà Understanding Price Charts</h3><p class="mb-4">Charts show you how a cryptocurrency's price has changed over time. Learning to read them is essential for making informed trading decisions!</p></div><h4 class="text-lg font-semibold">üìä Common Chart Types</h4><div class="space-y-4"><div class="bg-white/5 rounded-xl p-4"><h5 class="font-semibold mb-2">Line Chart</h5><p class="text-sm text-gray-400 mb-2">The simplest chart ‚Äî just a line connecting closing prices over time. Great for seeing the overall trend at a glance.</p></div><div class="bg-white/5 rounded-xl p-4"><h5 class="font-semibold mb-2">Candlestick Chart</h5><p class="text-sm text-gray-400 mb-2">Shows open, high, low, and close prices for each time period.</p><div class="flex gap-4 mt-3"><div class="flex items-center gap-2"><div class="w-4 h-6 bg-green-500 rounded"></div><span class="text-xs">Green = Price went UP</span></div><div class="flex items-center gap-2"><div class="w-4 h-6 bg-red-500 rounded"></div><span class="text-xs">Red = Price went DOWN</span></div></div></div></div><h4 class="text-lg font-semibold">üìê Support and Resistance</h4><div class="bg-white/5 rounded-xl p-4"><p class="mb-2"><strong>Support:</strong> A price level where buying is strong enough to prevent the price from falling further. Think of it as a "floor."</p><p><strong>Resistance:</strong> A price level where selling pressure prevents the price from rising further. Think of it as a "ceiling."</p></div></div>`
            },
            3: {
                title: 'Risk Management',
                category: 'Intermediate',
                content: `<div class="space-y-6"><div class="bg-red-500/10 border border-red-500/30 rounded-xl p-6"><h3 class="text-xl font-semibold mb-4 text-red-400">üõ°Ô∏è Protect Your Money</h3><p class="mb-4">Risk management is the #1 skill that separates successful traders from those who lose everything. It's not about making huge gains ‚Äî it's about not losing what you have!</p></div><h4 class="text-lg font-semibold">‚ö†Ô∏è The Golden Rules</h4><div class="space-y-4"><div class="bg-white/5 rounded-xl p-4 border-l-4 border-yellow-500"><h5 class="font-semibold mb-2">1. Never Invest More Than You Can Afford to Lose</h5><p class="text-sm text-gray-400">Crypto is volatile. Only use money you don't need for rent, food, or emergencies.</p></div><div class="bg-white/5 rounded-xl p-4 border-l-4 border-yellow-500"><h5 class="font-semibold mb-2">2. Diversification</h5><p class="text-sm text-gray-400">Don't put all your eggs in one basket. Spread investments across different cryptocurrencies.</p></div></div><div class="bg-green-500/10 border border-green-500/30 rounded-xl p-6"><h4 class="text-lg font-semibold mb-2 text-green-400">‚úÖ The Smart Approach</h4><ul class="list-disc list-inside space-y-2"><li>Have a trading plan and stick to it</li><li>Accept that losses are part of trading</li><li>Don't trade emotionally</li></ul></div></div>`
            },
            4: {
                title: 'Altcoins Explained',
                category: 'Intermediate',
                content: `<div class="space-y-6"><div class="bg-purple-500/10 border border-purple-500/30 rounded-xl p-6"><h3 class="text-xl font-semibold mb-4 text-purple-400">üíé Beyond Bitcoin</h3><p class="mb-4">"Altcoin" = Alternative Coin. Any cryptocurrency that isn't Bitcoin. There are thousands of them, each with different purposes!</p></div><h4 class="text-lg font-semibold">üèÜ Major Altcoins</h4><div class="space-y-4"><div class="bg-white/5 rounded-xl p-4"><div class="flex items-center gap-3 mb-2"><div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center font-bold text-white">Œû</div><div><h5 class="font-semibold">Ethereum (ETH)</h5><p class="text-xs text-gray-400">Market Cap Rank #2</p></div></div><p class="text-sm text-gray-400">The foundation of DeFi and NFTs. Ethereum introduced "smart contracts" ‚Äî programmable money.</p></div><div class="bg-white/5 rounded-xl p-4"><div class="flex items-center gap-3 mb-2"><div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center font-bold text-white">S</div><div><h5 class="font-semibold">Solana (SOL)</h5><p class="text-xs text-gray-400">The "Ethereum Killer"</p></div></div><p class="text-sm text-gray-400">Extremely fast and cheap transactions. Popular for NFTs and DeFi.</p></div></div><div class="bg-red-500/10 border border-red-500/30 rounded-xl p-6"><h4 class="text-lg font-semibold mb-2 text-red-400">‚ö†Ô∏è Beware of Scams!</h4><p>Many altcoins are created just to steal money ("rug pulls"). Before investing, research the team and read the whitepaper.</p></div></div>`
            },
            5: {
                title: 'Trading Strategies',
                category: 'Advanced',
                content: `<div class="space-y-6"><div class="bg-purple-500/10 border border-purple-500/30 rounded-xl p-6"><h3 class="text-xl font-semibold mb-4 text-purple-400">üéØ Strategic Trading</h3><p class="mb-4">Random buying and selling rarely works. Successful traders use proven strategies based on research and discipline.</p></div><h4 class="text-lg font-semibold">üìà Dollar-Cost Averaging (DCA)</h4><div class="bg-white/5 rounded-xl p-4"><p class="mb-2"><strong>The Idea:</strong> Buy a fixed amount of crypto at regular intervals, regardless of price.</p><p class="mb-2"><strong>Example:</strong> Buy $100 of Bitcoin every Monday, no matter if the price is up or down.</p><p class="text-green-400 text-sm">‚úÖ Best for: Beginners, long-term investors</p></div><h4 class="text-lg font-semibold">üíé HODL (Hold On for Dear Life)</h4><div class="bg-white/5 rounded-xl p-4"><p class="mb-2"><strong>The Idea:</strong> Buy and hold for years, ignoring short-term price movements.</p><p class="text-green-400 text-sm">‚úÖ Best for: People who believe in crypto long-term</p></div><div class="bg-green-500/10 border border-green-500/30 rounded-xl p-6"><h4 class="text-lg font-semibold mb-2 text-green-400">‚úÖ Best Strategy for Beginners</h4><p class="font-semibold">DCA + Diversification + Long-term holding</p></div></div>`
            },
            6: {
                title: 'Market Psychology',
                category: 'Expert',
                content: `<div class="space-y-6"><div class="bg-teal-500/10 border border-teal-500/30 rounded-xl p-6"><h3 class="text-xl font-semibold mb-4 text-teal-400">üß† Master Your Mind</h3><p class="mb-4">Trading is 80% psychology and 20% strategy. The biggest enemy in trading is often yourself.</p></div><h4 class="text-lg font-semibold">üò∞ Common Emotional Traps</h4><div class="space-y-4"><div class="bg-white/5 rounded-xl p-4 border-l-4 border-red-500"><h5 class="font-semibold text-red-400 mb-2">FOMO (Fear Of Missing Out)</h5><p class="text-sm text-gray-400">Seeing a coin pump and buying in panic. Usually results in buying at the top!</p></div><div class="bg-white/5 rounded-xl p-4 border-l-4 border-orange-500"><h5 class="font-semibold text-orange-400 mb-2">Panic Selling</h5><p class="text-sm text-gray-400">Selling when prices drop out of fear. Often results in selling at the bottom!</p></div></div><div class="bg-purple-500/10 border border-purple-500/30 rounded-xl p-6"><h4 class="text-lg font-semibold mb-2 text-purple-400">üéØ The Ultimate Secret</h4><p class="font-semibold text-lg">"Be greedy when others are fearful, and fearful when others are greedy" ‚Äî Warren Buffett</p></div></div>`
            }
        };

        function openLesson(id) {
            const lesson = lessons[id];
            if (!lesson) return;
            if (id > 1 && !state.user.completedLessons.includes(id - 1)) {
                showToast('Complete the previous lesson first!', 'error');
                return;
            }
            state.currentLesson = id;
            document.getElementById('lessonModalTitle').textContent = lesson.title;
            document.getElementById('lessonModalCategory').textContent = lesson.category;
            document.getElementById('lessonModalContent').innerHTML = lesson.content;
            const completeBtn = document.getElementById('completeLessonBtn');
            if (state.user.completedLessons.includes(id)) {
                completeBtn.textContent = '‚úì Already Completed';
                completeBtn.disabled = true;
                completeBtn.classList.add('opacity-50');
            } else {
                completeBtn.textContent = '‚úì Mark as Complete (+50 XP)';
                completeBtn.disabled = false;
                completeBtn.classList.remove('opacity-50');
            }
            document.getElementById('lessonModal').classList.remove('hidden');
        }

        function closeLesson() {
            document.getElementById('lessonModal').classList.add('hidden');
            state.currentLesson = null;
        }

        function completeLesson() {
            if (!state.currentLesson || state.user.completedLessons.includes(state.currentLesson)) return;
            state.user.completedLessons.push(state.currentLesson);
            addXP(50);
            unlockAchievement('lesson_' + state.currentLesson);
            saveState();
            updateLessonProgress();
            showToast('Lesson completed! +50 XP', 'success');
            createConfetti();
            closeLesson();
        }

        function initializeAchievements() {
            const allAchievements = [
                { id: 'welcome', name: 'Welcome Aboard', icon: 'üéì', description: 'Started your crypto journey', unlocked: false },
                { id: 'first_buy', name: 'First Steps', icon: 'üí∞', description: 'Made your first purchase', unlocked: false },
                { id: 'first_sell', name: 'First Sale', icon: 'üí∏', description: 'Made your first sale', unlocked: false },
                { id: 'first_profit', name: 'Profitable Trader', icon: 'üìà', description: 'Made a profit on a trade', unlocked: false },
                { id: 'lesson_1', name: 'Bitcoin Basics', icon: '‚Çø', description: 'Completed Bitcoin lesson', unlocked: false },
                { id: 'lesson_2', name: 'Chart Master', icon: 'üìä', description: 'Completed chart reading lesson', unlocked: false },
                { id: 'lesson_3', name: 'Risk Manager', icon: 'üõ°Ô∏è', description: 'Completed risk management lesson', unlocked: false },
                { id: 'lesson_4', name: 'Altcoin Expert', icon: 'üíé', description: 'Completed altcoins lesson', unlocked: false },
                { id: 'lesson_5', name: 'Strategy Pro', icon: 'üéØ', description: 'Completed trading strategies lesson', unlocked: false },
                { id: 'lesson_6', name: 'Psychology Master', icon: 'üß†', description: 'Completed psychology lesson', unlocked: false },
            ];
            if (state.user.achievements.length === 0) {
                state.user.achievements = allAchievements;
            }
            unlockAchievement('welcome');
        }

        function unlockAchievement(id) {
            const achievement = state.user.achievements.find(a => a.id === id);
            if (achievement && !achievement.unlocked) {
                achievement.unlocked = true;
                saveState();
                updateAchievements();
                showToast(`Achievement unlocked: ${achievement.name}!`, 'success');
            }
        }

        function updateAchievements() {
            const grid = document.getElementById('achievementsGrid');
            if (!grid) return;
            grid.innerHTML = state.user.achievements.map(a => {
                const isUnlocked = a.unlocked;
                return `<div class="${isUnlocked ? '' : 'opacity-40 grayscale'} bg-white/5 rounded-xl p-4 text-center cursor-pointer hover:bg-white/10 transition group has-tooltip relative">
                    <div class="text-4xl mb-2">${a.icon}</div>
                    <h4 class="font-semibold text-sm">${a.name}</h4>
                    ${!isUnlocked ? '<div class="mt-2 text-xs text-gray-500">Locked</div>' : ''}
                    <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 bg-black/90 rounded-lg text-sm whitespace-nowrap z-10">${a.description}</div>
                </div>`;
            }).join('');
        }

        function addXP(amount) {
            state.user.xp += amount;
            const newLevel = Math.floor(state.user.xp / 100) + 1;
            if (newLevel > state.user.level) {
                state.user.level = newLevel;
                showToast(`Level up! You're now level ${newLevel}!`, 'success');
                createConfetti();
            }
            updateLevel();
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('tab-active');
                el.classList.add('bg-white/10');
            });
            document.getElementById('content-' + tabName).classList.remove('hidden');
            const activeBtn = document.getElementById('tab-' + tabName);
            activeBtn.classList.add('tab-active');
            activeBtn.classList.remove('bg-white/10');
            if (tabName === 'portfolio') setTimeout(updatePortfolioChart, 100);
        }

        function startApp() {
            const skipWelcome = document.getElementById('skipWelcome').checked;
            if (skipWelcome) {
                state.user.skipWelcome = true;
                saveState();
            }
            document.getElementById('welcomeModal').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('opacity-50', 'pointer-events-none');
            showToast('Welcome to Crypto Academy! üéì', 'success');
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            const colors = { success: 'bg-green-500', error: 'bg-red-500', info: 'bg-blue-500' };
            toast.className = `${colors[type]} text-white px-6 py-3 rounded-xl shadow-lg slide-in flex items-center gap-2`;
            toast.innerHTML = `<span>${type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚Ñπ'}</span><span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function createConfetti() {
            for (let i = 0; i < 20; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = ['#ff0', '#f0f', '#0ff', '#0f0', '#f00'][Math.floor(Math.random() * 5)];
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
        }

        function showHelp() {
            showToast('Need help? Check out the Learn tab for tutorials!', 'info');
        }

        function selectCrypto(id) {
            showTab('trade');
            document.getElementById('buyCryptoSelect').value = id;
            updateBuyPreview();
        }

        function quickBuy(id) {
            showTab('trade');
            document.getElementById('buyCryptoSelect').value = id;
            setBuyAmount(100);
        }

        function formatMoney(amount) {
            return '$' + amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function stringToColor(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = str.charCodeAt(i) + ((hash << 5) - hash);
            }
            const c = (hash & 0x00FFFFFF).toString(16).toUpperCase();
            return '#' + '00000'.substring(0, 6 - c.length) + c;
        }

        function setupEventListeners() {
            document.getElementById('buyAmountSlider')?.addEventListener('input', (e) => {
                document.getElementById('buyAmount').value = e.target.value;
                updateBuyPreview();
            });
            document.getElementById('buyAmount')?.addEventListener('input', (e) => {
                document.getElementById('buyAmountSlider').value = e.target.value;
                updateBuyPreview();
            });
            document.getElementById('buyCryptoSelect')?.addEventListener('change', updateBuyPreview);
            document.getElementById('sellAmountSlider')?.addEventListener('input', (e) => {
                document.getElementById('sellPercent').value = e.target.value;
                updateSellPreview();
            });
            document.getElementById('sellPercent')?.addEventListener('input', (e) => {
                document.getElementById('sellAmountSlider').value = e.target.value;
                updateSellPreview();
            });
            document.getElementById('sellCryptoSelect')?.addEventListener('change', updateSellPreview);
            document.getElementById('cryptoSearch')?.addEventListener('input', updateCryptoTable);
        }
    </script>
</body>
</html>